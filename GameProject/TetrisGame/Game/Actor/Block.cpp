#include "Block.h"
#include "Level/GameLevel.h"

int Block::shapeCount = 0;

// 블록 초기화
BlockType blockTypes[7] =
{
    { // I 블록
        {
            { {0, 0, 0, 0}, {2, 2, 2, 2}, {0, 0, 0, 0}, {0, 0, 0, 0} }, // 0°
            { {0, 0, 2, 0}, {0, 0, 2, 0}, {0, 0, 2, 0}, {0, 0, 2, 0} }, // 90°
            { {0, 0, 0, 0}, {0, 0, 0, 0}, {2, 2, 2, 2}, {0, 0, 0, 0} }, // 180°
            { {0, 2, 0, 0}, {0, 2, 0, 0}, {0, 2, 0, 0}, {0, 2, 0, 0} }  // 270°
        },
        Color::Aqua, false
    },
    { // J 블록
        {
            { {0, 0, 0, 0}, {0, 0, 2, 0}, {0, 0, 2, 0}, {0, 2, 2, 0} }, // 0°
            { {0, 0, 0, 0}, {0, 2, 0, 0}, {0, 2, 2, 2}, {0, 0, 0, 0} }, // 90°
            { {0, 0, 0, 0}, {0, 2, 2, 0}, {0, 2, 0, 0}, {0, 2, 0, 0} }, // 180°
            { {0, 0, 0, 0}, {0, 2, 2, 2}, {0, 0, 0, 2}, {0, 0, 0, 0} }  // 270°
        },
        Color::Blue, false
    },
    { // L 블록
        {
            { {0, 0, 0, 0}, {0, 2, 0, 0}, {0, 2, 0, 0}, {0, 2, 2, 0} }, // 0°
            { {0, 0, 0, 0}, {0, 2, 2, 2}, {0, 2, 0, 0}, {0, 0, 0, 0} }, // 90°
            { {0, 0, 0, 0}, {0, 2, 2, 0}, {0, 0, 2, 0}, {0, 0, 2, 0} }, // 180°
            { {0, 0, 0, 0}, {0, 0, 0, 2}, {0, 2, 2, 2}, {0, 0, 0, 0} }  // 270°
        },
        Color::Orange, false
    },
    { // O 블록
        {
            { {0, 0, 0, 0}, {0, 2, 2, 0}, {0, 2, 2, 0}, {0, 0, 0, 0} }, // 0°
            { {0, 0, 0, 0}, {0, 2, 2, 0}, {0, 2, 2, 0}, {0, 0, 0, 0} }, // 90°
            { {0, 0, 0, 0}, {0, 2, 2, 0}, {0, 2, 2, 0}, {0, 0, 0, 0} }, // 180°
            { {0, 0, 0, 0}, {0, 2, 2, 0}, {0, 2, 2, 0}, {0, 0, 0, 0} }  // 270°
        },
        Color::Yellow, false
    },
    { // S 블록
        {
            { {0, 0, 0, 0}, {0, 2, 0, 0}, {0, 2, 2, 0}, {0, 0, 2, 0} }, // 0°
            { {0, 0, 0, 0}, {0, 0, 2, 2}, {0, 2, 2, 0}, {0, 0, 0, 0} }, // 90°
            { {0, 0, 0, 0}, {0, 2, 0, 0}, {0, 2, 2, 0}, {0, 0, 2, 0} }, // 180°
            { {0, 0, 0, 0}, {0, 0, 2, 2}, {0, 2, 2, 0}, {0, 0, 0, 0} }  // 270°
        },
        Color::Green, false
    },
    { // T 블록
        {
            { {0, 0, 0, 0}, {0, 2, 0, 0}, {2, 2, 2, 0}, {0, 0, 0, 0} }, // 0°
            { {0, 0, 0, 0}, {0, 2, 0, 0}, {0, 2, 2, 0}, {0, 2, 0, 0} }, // 90°
            { {0, 0, 0, 0}, {0, 0, 0, 0}, {2, 2, 2, 0}, {0, 2, 0, 0} }, // 180°
            { {0, 0, 0, 0}, {0, 0, 2, 0}, {0, 2, 2, 0}, {0, 0, 2, 0} }  // 270°
        },
        Color::Purple, false
    },
    { // Z 블록
        {
            { {0, 0, 0, 0}, {0, 0, 2, 0}, {0, 2, 2, 0}, {0, 2, 0, 0} }, // 0°
            { {0, 0, 0, 0}, {0, 2, 2, 0}, {0, 0, 2, 2}, {0, 0, 0, 0} }, // 90°
            { {0, 0, 0, 0}, {0, 0, 2, 0}, {0, 2, 2, 0}, {0, 2, 0, 0} }, // 180°
            { {0, 0, 0, 0}, {0, 2, 2, 0}, {0, 0, 2, 2}, {0, 0, 0, 0} }  // 270°
        },
        Color::Red, false
    }
};

Block::Block(const Vector2& position)
    : blockPosition(position.x + 4, position.y-1)
    //: blockPosition(4, 0)
{
	// 모양 결정 변수
	int shapeIdx = 0;
	while (true)
	{
		if (shapeCount == 7)
		{
			for (int ix = 0;ix < shapeCount;++ix)
			{
				blockTypes[ix].create = false;
			}
			shapeCount = 0;
		}

		// 블록 모양 선택.
		shapeIdx = Random(0, 6);

		// 블록 모양이 7번 안에 나온적이 없을 경우.
		if (blockTypes[shapeIdx].create == false)
		{
			++shapeCount;
			blockType = blockTypes[shapeIdx];
			blockTypes[shapeIdx].create = true;
			break;
		}
	}
}

Block::~Block()
{
}